{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_PlayGround = _resolveComponent(\"PlayGround\");\n  const _component_MatchGround = _resolveComponent(\"MatchGround\");\n  const _component_ResultBoard = _resolveComponent(\"ResultBoard\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_ctx.$store.state.pk.status === 'Playing' ? (_openBlock(), _createBlock(_component_PlayGround, {\n    key: 0\n  })) : _createCommentVNode(\"v-if\", true), _ctx.$store.state.pk.status === 'Matching' ? (_openBlock(), _createBlock(_component_MatchGround, {\n    key: 1\n  })) : _createCommentVNode(\"v-if\", true), _ctx.$store.state.pk.loser != '' ? (_openBlock(), _createBlock(_component_ResultBoard, {\n    key: 2\n  })) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementBlock","_Fragment","_ctx","$store","state","pk","status","_createBlock","_component_PlayGround","key","_createCommentVNode","_component_MatchGround","loser","_component_ResultBoard"],"sources":["/Users/muzhouliu/Desktop/acwing/kob/web/src/views/pk/pkIndexView.vue"],"sourcesContent":["<template>\n    <PlayGround v-if=\"$store.state.pk.status === 'Playing' \"></PlayGround>\n    <MatchGround v-if=\"$store.state.pk.status === 'Matching'\"></MatchGround>\n    <ResultBoard v-if=\"$store.state.pk.loser != ''\"></ResultBoard>\n</template>\n\n\n<script>\nimport PlayGround from \"@/components/PlayGround.vue\"\nimport MatchGround from \"@/components/MatchGround.vue\"\nimport ResultBoard from \"@/components/ResultBoard.vue\"\nimport { onMounted, onUnmounted } from \"vue\"\nimport { useStore } from \"vuex\";\n\nexport default {\n    components: {\n        PlayGround,\n        MatchGround,\n        ResultBoard,\n    },\n    setup() {\n        const store = useStore();\n        const socketUrl = `ws://localhost:8888/websocket/${store.state.user.token}`;\n\n        let socket = null;\n        onMounted(() => {\n            store.commit(\"updateOpponent\", {\n                username: '???',\n                photo : \"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png\"\n            })\n            socket = new WebSocket(socketUrl);\n\n            socket.onopen = () => {\n                console.log(\"Connected\");\n                store.commit(\"updateSocket\", socket)\n            }\n\n            socket.onmessage = msg => {\n                const data = JSON.parse(msg.data);\n                if (data.event === \"start-matching\") { // maching success\n                    store.commit(\"updateOpponent\", {\n                        username: data.opponent_username,\n                        photo: data.opponent_photo,\n                    });\n                    setTimeout(() => {\n                        store.commit(\"updateStatus\", \"Playing\")\n                    }, 0)\n                    store.commit(\"updateGame\", data.game)\n                } else if (data.event === \"move\") {\n                    const game = store.state.pk.gameObject;\n                    const [snake0, snake1] = game.snakes;\n                    snake0.set_direction(data.a_direction);\n                    snake1.set_direction(data.b_direction);\n                } else if (data.event === \"result\") {\n                    console.log(data);\n                    const game = store.state.pk.gameObject;\n                    const [snake0, snake1] = game.snakes;\n                    \n                    if (data.loser === \"All\" || data.loser === \"A\") {\n                        snake0.status = \"die\";\n                    }\n                    if (data.loser === \"All\" || data.loser === \"B\") {\n                        snake1.status = \"die\";\n                    }\n                }\n                console.log(data);\n            }\n\n            socket.onclose = () => {\n                console.log(\"Connection closed\");\n            }\n\n        });\n\n        onUnmounted(() => {\n            socket.close();\n        })\n    }\n\n}\n</script>\n\n\n<style scoped>\n</style>"],"mappings":";;;;;uBAAAA,mBAAA,CAAAC,SAAA,SACsBC,IAAA,CAAAC,MAAM,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,kB,cAAxCC,YAAA,CAAsEC,qBAAA;IAD1EC,GAAA;EAAA,MAAAC,mBAAA,gBAEuBR,IAAA,CAAAC,MAAM,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,mB,cAAzCC,YAAA,CAAwEI,sBAAA;IAF5EF,GAAA;EAAA,MAAAC,mBAAA,gBAGuBR,IAAA,CAAAC,MAAM,CAACC,KAAK,CAACC,EAAE,CAACO,KAAK,U,cAAxCL,YAAA,CAA8DM,sBAAA;IAHlEJ,GAAA;EAAA,MAAAC,mBAAA,e"},"metadata":{},"sourceType":"module","externalDependencies":[]}