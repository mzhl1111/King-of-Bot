{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createCommentVNode as _createCommentVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_CoundDownEffect = _resolveComponent(\"CoundDownEffect\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_CoundDownEffect, {\n    \"\\\"\": \"\"\n  }), _createCommentVNode(\" <PlayGround v-if=\\\"$store.state.pk.status === 'Playing' && show_countdown === 'no'\\\"></PlayGround>\\n    <MatchGround v-if=\\\"$store.state.pk.status === 'Matching' && show_countdown === 'no'\\\"></MatchGround> \")], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementBlock","_Fragment","_createVNode","_component_CoundDownEffect","_createCommentVNode"],"sources":["/Users/muzhouliu/Desktop/acwing/kob/web/src/views/pk/pkIndexView.vue"],"sourcesContent":["<template>\n    <CoundDownEffect \"/>\n    <!-- <PlayGround v-if=\"$store.state.pk.status === 'Playing' && show_countdown === 'no'\"></PlayGround>\n    <MatchGround v-if=\"$store.state.pk.status === 'Matching' && show_countdown === 'no'\"></MatchGround> -->\n</template>\n\n\n<script>\n// import PlayGround from \"@/components/PlayGround.vue\"\n// import MatchGround from \"@/components/MatchGround.vue\"\nimport CoundDownEffect from \"@/components/CoundDownEffect.vue\";\nimport { onMounted, onUnmounted , ref} from \"vue\"\nimport { useStore } from \"vuex\";\n\nexport default {\n    components: {\n    PlayGround,\n    MatchGround,\n    CoundDownEffect\n},\n    setup() {\n        const store = useStore();\n        const socketUrl = `ws://localhost:8888/websocket/${store.state.user.token}`;\n        let show_countdown = ref(\"no\")\n\n        let socket = null;\n        onMounted(() => {\n            store.commit(\"updateOpponent\", {\n                username: '???',\n                photo : \"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png\"\n            })\n            socket = new WebSocket(socketUrl);\n\n            socket.onopen = () => {\n                console.log(\"Connected\");\n                store.commit(\"updateSocket\", socket)\n            }\n\n            socket.onmessage = msg => {\n                const data = JSON.parse(msg.data);\n                if (data.event === \"start-matching\") { // maching success\n                    store.commit(\"updateOpponent\", {\n                        username: data.opponent_username,\n                        photo: data.opponent_photo,\n                    });\n                    show_countdown.value = 'yes';\n                    setTimeout(() => {\n                        store.commit(\"updateStatus\", \"Playing\"), 2000\n                    })\n                    show_countdown.value = 'no';\n                    store.commit(\"updateGameMap\", data.game_map)\n                }\n                console.log(data);\n            }\n\n            socket.onclose = () => {\n                console.log(\"Connection closed\");\n            }\n\n        });\n\n        onUnmounted(() => {\n            socket.close();\n        })\n\n        return {\n            show_countdown\n        }\n    }\n\n}\n</script>\n\n\n<style scoped>\n</style>"],"mappings":";;;uBAAAA,mBAAA,CAAAC,SAAA,SACIC,YAAA,CAAoBC,0BAAA;IAAH,IAAC,EAAD;EAAC,IAClBC,mBAAA,mNACuG,C"},"metadata":{},"sourceType":"module","externalDependencies":[]}