{"ast":null,"code":"import PlayGround from \"@/components/PlayGround.vue\";\nimport MatchGround from \"@/components/MatchGround.vue\";\nimport { onMounted, onUnmounted, ref } from \"vue\";\nimport { useStore } from \"vuex\";\nexport default {\n  components: {\n    PlayGround,\n    MatchGround\n  },\n  setup() {\n    const store = useStore();\n    const socketUrl = `ws://localhost:8888/websocket/${store.state.user.token}`;\n    let show_countdown = ref(\"no\");\n    let two_seconds_later = ref();\n    let socket = null;\n    onMounted(() => {\n      store.commit(\"updateOpponent\", {\n        username: '???',\n        photo: \"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png\"\n      });\n      socket = new WebSocket(socketUrl);\n      socket.onopen = () => {\n        console.log(\"Connected\");\n        store.commit(\"updateSocket\", socket);\n      };\n      socket.onmessage = msg => {\n        const data = JSON.parse(msg.data);\n        if (data.event === \"start-matching\") {\n          // maching success\n          store.commit(\"updateOpponent\", {\n            username: data.opponent_username,\n            photo: data.opponent_photo\n          });\n          show_countdown.value = 'yes';\n          setTimeout(() => {\n            store.commit(\"updateStatus\", \"Playing\");\n          }, 2000);\n          show_countdown.value = 'no';\n          store.commit(\"updateGameMap\", data.game_map);\n        }\n        console.log(data);\n      };\n      socket.onclose = () => {\n        console.log(\"Connection closed\");\n      };\n    });\n    onUnmounted(() => {\n      socket.close();\n    });\n    return {\n      show_countdown\n    };\n  },\n  data() {\n    const now = new Date();\n    const newYear = new Date(now.getSeconds() + 2, 0, 1);\n    return {\n      time: newYear - now\n    };\n  }\n};","map":{"version":3,"names":["PlayGround","MatchGround","onMounted","onUnmounted","ref","useStore","components","setup","store","socketUrl","state","user","token","show_countdown","two_seconds_later","socket","commit","username","photo","WebSocket","onopen","console","log","onmessage","msg","data","JSON","parse","event","opponent_username","opponent_photo","value","setTimeout","game_map","onclose","close","now","Date","newYear","getSeconds","time"],"sources":["/Users/muzhouliu/Desktop/acwing/kob/web/src/views/pk/pkIndexView.vue"],"sourcesContent":["<template>\n    <vue-countdown v-if=\"show_countdown === 'yes'\" :time=\"time\" :interval=\"100\" v-slot=\"{seconds, milliseconds }\">\n    Game Starts in {{ seconds }}.{{ Math.floor(milliseconds / 100) }} seconds.\n  </vue-countdown>\n    <PlayGround v-if=\"$store.state.pk.status === 'Playing' && show_countdown === 'no'\"></PlayGround>\n    <MatchGround v-if=\"$store.state.pk.status === 'Matching' && show_countdown === 'no'\"></MatchGround>\n</template>\n\n\n<script>\nimport PlayGround from \"@/components/PlayGround.vue\"\nimport MatchGround from \"@/components/MatchGround.vue\"\nimport { onMounted, onUnmounted , ref} from \"vue\"\nimport { useStore } from \"vuex\";\n\nexport default {\n    components: {\n    PlayGround,\n    MatchGround,\n    },\n    setup() {\n        const store = useStore();\n        const socketUrl = `ws://localhost:8888/websocket/${store.state.user.token}`;\n        let show_countdown = ref(\"no\")\n        let two_seconds_later = ref()\n\n        let socket = null;\n        onMounted(() => {\n            store.commit(\"updateOpponent\", {\n                username: '???',\n                photo : \"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png\"\n            })\n            socket = new WebSocket(socketUrl);\n\n            socket.onopen = () => {\n                console.log(\"Connected\");\n                store.commit(\"updateSocket\", socket)\n            }\n\n            socket.onmessage = msg => {\n                const data = JSON.parse(msg.data);\n                if (data.event === \"start-matching\") { // maching success\n                    store.commit(\"updateOpponent\", {\n                        username: data.opponent_username,\n                        photo: data.opponent_photo,\n                    });\n                    show_countdown.value = 'yes';\n                    setTimeout(() => {\n                        store.commit(\"updateStatus\", \"Playing\")\n                    }, 2000)\n                    show_countdown.value = 'no';\n                    store.commit(\"updateGameMap\", data.game_map)\n                }\n                console.log(data);\n            }\n\n            socket.onclose = () => {\n                console.log(\"Connection closed\");\n            }\n\n        });\n\n        onUnmounted(() => {\n            socket.close();\n        })\n\n        return {\n            show_countdown\n        }\n    },\n    data() {\n        const now = new Date();\n        const newYear = new Date(now.getSeconds() + 2, 0, 1);\n\n        return {\n        time: newYear - now,\n        }\n    }   \n\n}\n</script>\n\n\n<style scoped>\n</style>"],"mappings":"AAUA,OAAOA,UAAS,MAAO,6BAA4B;AACnD,OAAOC,WAAU,MAAO,8BAA6B;AACrD,SAASC,SAAS,EAAEC,WAAU,EAAIC,GAAG,QAAO,KAAI;AAChD,SAASC,QAAO,QAAS,MAAM;AAE/B,eAAe;EACXC,UAAU,EAAE;IACZN,UAAU;IACVC;EACA,CAAC;EACDM,KAAKA,CAAA,EAAG;IACJ,MAAMC,KAAI,GAAIH,QAAQ,CAAC,CAAC;IACxB,MAAMI,SAAQ,GAAK,iCAAgCD,KAAK,CAACE,KAAK,CAACC,IAAI,CAACC,KAAM,EAAC;IAC3E,IAAIC,cAAa,GAAIT,GAAG,CAAC,IAAI;IAC7B,IAAIU,iBAAgB,GAAIV,GAAG,CAAC;IAE5B,IAAIW,MAAK,GAAI,IAAI;IACjBb,SAAS,CAAC,MAAM;MACZM,KAAK,CAACQ,MAAM,CAAC,gBAAgB,EAAE;QAC3BC,QAAQ,EAAE,KAAK;QACfC,KAAI,EAAI;MACZ,CAAC;MACDH,MAAK,GAAI,IAAII,SAAS,CAACV,SAAS,CAAC;MAEjCM,MAAM,CAACK,MAAK,GAAI,MAAM;QAClBC,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC;QACxBd,KAAK,CAACQ,MAAM,CAAC,cAAc,EAAED,MAAM;MACvC;MAEAA,MAAM,CAACQ,SAAQ,GAAIC,GAAE,IAAK;QACtB,MAAMC,IAAG,GAAIC,IAAI,CAACC,KAAK,CAACH,GAAG,CAACC,IAAI,CAAC;QACjC,IAAIA,IAAI,CAACG,KAAI,KAAM,gBAAgB,EAAE;UAAE;UACnCpB,KAAK,CAACQ,MAAM,CAAC,gBAAgB,EAAE;YAC3BC,QAAQ,EAAEQ,IAAI,CAACI,iBAAiB;YAChCX,KAAK,EAAEO,IAAI,CAACK;UAChB,CAAC,CAAC;UACFjB,cAAc,CAACkB,KAAI,GAAI,KAAK;UAC5BC,UAAU,CAAC,MAAM;YACbxB,KAAK,CAACQ,MAAM,CAAC,cAAc,EAAE,SAAS;UAC1C,CAAC,EAAE,IAAI;UACPH,cAAc,CAACkB,KAAI,GAAI,IAAI;UAC3BvB,KAAK,CAACQ,MAAM,CAAC,eAAe,EAAES,IAAI,CAACQ,QAAQ;QAC/C;QACAZ,OAAO,CAACC,GAAG,CAACG,IAAI,CAAC;MACrB;MAEAV,MAAM,CAACmB,OAAM,GAAI,MAAM;QACnBb,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;MACpC;IAEJ,CAAC,CAAC;IAEFnB,WAAW,CAAC,MAAM;MACdY,MAAM,CAACoB,KAAK,CAAC,CAAC;IAClB,CAAC;IAED,OAAO;MACHtB;IACJ;EACJ,CAAC;EACDY,IAAIA,CAAA,EAAG;IACH,MAAMW,GAAE,GAAI,IAAIC,IAAI,CAAC,CAAC;IACtB,MAAMC,OAAM,GAAI,IAAID,IAAI,CAACD,GAAG,CAACG,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IAEpD,OAAO;MACPC,IAAI,EAAEF,OAAM,GAAIF;IAChB;EACJ;AAEJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}