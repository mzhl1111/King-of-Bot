{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { GameObject } from \"./GameObject\";\nimport { Wall } from \"./wall\";\nimport { Snake } from \"./Snake\";\nexport class GameMap extends GameObject {\n  constructor(ctx, parent, store) {\n    super();\n    this.ctx = ctx;\n    this.parent = parent;\n    this.store = store;\n    this.L = 0;\n    this.rows = 13;\n    this.cols = 14;\n    this.walls = [];\n    this.inner_wall_count = 20;\n    this.snakes = [new Snake({\n      id: 0,\n      color: \"#4876EC\",\n      r: this.rows - 2,\n      c: 1\n    }, this), new Snake({\n      id: 1,\n      color: \"#F94848\",\n      r: 1,\n      c: this.cols - 2\n    }, this)];\n  }\n  create_walls() {\n    const g = this.store.state.pk.game_map;\n    for (let r = 0; r < this.rows; r++) {\n      for (let c = 0; c < this.cols; c++) {\n        if (g[r][c]) {\n          this.walls.push(new Wall(r, c, this));\n        }\n      }\n    }\n    return true;\n  }\n  add_listening_events() {\n    if (this.store.state.replay.is_replay) {\n      let k = 0;\n      console.log(this.store.state.replay);\n      const a_steps = JSON.parse(this.store.state.replay.a_steps);\n      const b_steps = JSON.parse(this.store.state.replay.b_steps);\n      const [snake0, snake1] = this.snakes;\n      const loser = this.store.state.replay.replay_loser;\n      const interval_id = setInterval(() => {\n        if (k >= a_steps.length - 1) {\n          // last step is a die operation, do not need to replay;\n          if (loser === \"All\" || loser === \"A\") {\n            snake0.status = \"die\";\n          }\n          if (loser === \"All\" || loser === \"B\") {\n            snake1.status = \"die\";\n          }\n          clearInterval(interval_id);\n        } else {\n          snake0.set_direction(a_steps[k]);\n          snake1.set_direction(b);\n        }\n      }, 300);\n    } else {\n      this.ctx.canvas.focus();\n      this.ctx.canvas.addEventListener(\"keydown\", e => {\n        let d = 0;\n        if (e.key === \"w\") d = 0;else if (e.key === \"d\") d = 1;else if (e.key === \"s\") d = 2;else if (e.key === \"a\") d = 3;\n        if (d >= 0) {\n          this.store.state.pk.socket.send(JSON.stringify({\n            event: \"move\",\n            direction: d\n          }));\n        }\n      });\n    }\n  }\n  start() {\n    for (let i = 0; i < 1000; i++) {\n      if (this.create_walls()) break;\n    }\n    this.add_listening_events();\n  }\n  update_size() {\n    this.L = parseInt(Math.min(this.parent.clientWidth / this.cols, this.parent.clientHeight / this.rows));\n    this.ctx.canvas.width = this.L * this.cols;\n    this.ctx.canvas.height = this.L * this.rows;\n  }\n  check_ready() {\n    //judge if two snake is ready for the next round\n    for (const snake of this.snakes) {\n      if (snake.status !== \"idle\") return false;\n      if (snake.direction === -1) return false;\n    }\n    return true;\n  }\n  next_step() {\n    // let the two snake goes into next round\n    for (const snake of this.snakes) {\n      snake.next_step();\n    }\n  }\n  judge(cell) {\n    // judge if cell is a valid moving target\n    for (const wall of this.walls) {\n      if (wall.r === cell.r && wall.c === cell.c) {\n        return false;\n      }\n    }\n    for (const snake of this.snakes) {\n      let k = snake.cells.length;\n      if (!snake.check_tail_increasing()) {\n        k--;\n      }\n      for (let i = 0; i < k; i++) {\n        if (snake.cells[i].r === cell.r && snake.cells[i].c === cell.c) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n  update() {\n    this.update_size();\n    this.render();\n    if (this.check_ready()) {\n      this.next_step();\n    }\n  }\n  render() {\n    const color_even = \"#82EAFD\",\n      color_odd = \"#02BADA\";\n    for (let r = 0; r < this.rows; r++) {\n      for (let c = 0; c < this.cols; c++) {\n        if ((r + c) % 2 == 0) {\n          this.ctx.fillStyle = color_even;\n        } else {\n          this.ctx.fillStyle = color_odd;\n        }\n        this.ctx.fillRect(c * this.L, r * this.L, this.L, this.L);\n      }\n    }\n  }\n}","map":{"version":3,"names":["GameObject","Wall","Snake","GameMap","constructor","ctx","parent","store","L","rows","cols","walls","inner_wall_count","snakes","id","color","r","c","create_walls","g","state","pk","game_map","push","add_listening_events","replay","is_replay","k","console","log","a_steps","JSON","parse","b_steps","snake0","snake1","loser","replay_loser","interval_id","setInterval","length","status","clearInterval","set_direction","b","canvas","focus","addEventListener","e","d","key","socket","send","stringify","event","direction","start","i","update_size","parseInt","Math","min","clientWidth","clientHeight","width","height","check_ready","snake","next_step","judge","cell","wall","cells","check_tail_increasing","update","render","color_even","color_odd","fillStyle","fillRect"],"sources":["/Users/muzhouliu/Desktop/acwing/kob/web/src/assets/scripts/GameMap.js"],"sourcesContent":["import { GameObject } from \"./GameObject\";\nimport { Wall } from \"./wall\";\nimport { Snake } from \"./Snake\";\n\nexport class GameMap extends GameObject {\n    constructor(ctx, parent, store) {\n        super();\n\n\n        this.ctx = ctx;\n        this.parent = parent;\n        this.store = store;\n        this.L = 0;\n\n        this.rows = 13;\n        this.cols = 14;\n\n        this.walls = [];\n        this.inner_wall_count = 20;\n\n        this.snakes = [\n            new Snake({id: 0, color: \"#4876EC\", r: this.rows - 2, c: 1}, this),\n            new Snake({id: 1, color: \"#F94848\", r: 1, c: this.cols - 2}, this),\n        ];\n    }\n\n\n\n    create_walls() {\n        const g = this.store.state.pk.game_map;\n\n        for(let r = 0; r < this.rows; r++) {\n            for(let c = 0; c < this.cols; c++) {\n                if(g[r][c]) {\n                    this.walls.push(new Wall(r, c, this))\n                }\n            }\n        }\n\n        return true;\n    }\n\n\n    add_listening_events() {\n        if (this.store.state.replay.is_replay) {\n            let k = 0;\n\n            console.log(this.store.state.replay)\n\n            const a_steps = JSON.parse(this.store.state.replay.a_steps);\n            const b_steps = JSON.parse(this.store.state.replay.b_steps);\n            const [snake0, snake1] = this.snakes;\n            const loser = this.store.state.replay.replay_loser;\n            const interval_id = setInterval(() => {\n                if (k >= a_steps.length - 1) { // last step is a die operation, do not need to replay;\n                    if (loser === \"All\" || loser === \"A\") {\n                        snake0.status = \"die\";\n                    }\n                    if (loser === \"All\" || loser === \"B\") {\n                        snake1.status = \"die\";\n                    }\n                    clearInterval(interval_id);\n                } else {\n                    snake0.set_direction(a_steps[k]);\n                    snake1.set_direction(b);\n                }\n            }, 300)\n        } else  {\n            this.ctx.canvas.focus();\n            this.ctx.canvas.addEventListener(\"keydown\", e => {\n                let d = 0;\n                if (e.key === \"w\") d = 0;\n                else if (e.key === \"d\") d = 1;\n                else if (e.key === \"s\") d = 2;\n                else if (e.key === \"a\") d = 3;\n    \n                if (d >= 0) {\n                    this.store.state.pk.socket.send(JSON.stringify({\n                        event: \"move\",\n                        direction: d,\n                    }))\n                }\n            })\n        }\n    }\n\n\n    start() {\n        for(let i =0; i < 1000; i++){\n            if (this.create_walls()) break;\n        }\n\n        this.add_listening_events();\n\n    }\n\n    update_size() {\n        this.L = parseInt(Math.min(this.parent.clientWidth / this.cols, this.parent.clientHeight / this.rows));\n        this.ctx.canvas.width = this.L * this.cols;\n        this.ctx.canvas.height = this.L * this.rows;\n    }\n\n\n    check_ready() { //judge if two snake is ready for the next round\n        for (const snake of this.snakes) {\n            if (snake.status !== \"idle\") return false;\n            if (snake.direction === -1) return false;\n        }\n        return true;\n    }\n\n    next_step() { // let the two snake goes into next round\n        for (const snake of this.snakes) {\n            snake.next_step();  \n        }\n    }\n\n    judge(cell) { // judge if cell is a valid moving target\n        for (const wall of this.walls) {\n            if (wall.r === cell.r && wall.c === cell.c){\n                return false;\n            }\n        }\n\n        for (const snake of this.snakes) {\n            let k = snake.cells.length;\n            if (!snake.check_tail_increasing()) {\n                k --;\n            }\n            for (let i = 0; i < k; i++) {\n                if (snake.cells[i].r === cell.r && snake.cells[i].c === cell.c) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    }\n\n    update() {\n        this.update_size();\n        this.render();\n        if (this.check_ready()) {\n            this.next_step();\n        }\n\n    }\n\n    render() {\n        const color_even = \"#82EAFD\", color_odd = \"#02BADA\";\n        for (let r = 0; r < this.rows; r++){\n            for (let c = 0; c < this.cols; c++) {\n                if ((r + c) % 2 == 0) {\n                    this.ctx.fillStyle = color_even;\n                } else {\n                    this.ctx.fillStyle = color_odd;\n                }\n                this.ctx.fillRect(c * this.L, r * this.L, this.L, this.L)\n            }\n        }\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}