{"ast":null,"code":"import { toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_vue_countdown = _resolveComponent(\"vue-countdown\");\n  const _component_PlayGround = _resolveComponent(\"PlayGround\");\n  const _component_MatchGround = _resolveComponent(\"MatchGround\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [$setup.show_countdown === 'yes' ? (_openBlock(), _createBlock(_component_vue_countdown, {\n    key: 0,\n    time: $data.time,\n    interval: 100\n  }, {\n    default: _withCtx(({\n      seconds,\n      milliseconds\n    }) => [_createTextVNode(\" Game Starts in \" + _toDisplayString(seconds) + \".\" + _toDisplayString(Math.floor(milliseconds / 100)) + \" seconds. \", 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"time\"])) : _createCommentVNode(\"v-if\", true), _ctx.$store.state.pk.status === 'Playing' && $setup.show_countdown === 'no' ? (_openBlock(), _createBlock(_component_PlayGround, {\n    key: 1\n  })) : _createCommentVNode(\"v-if\", true), _ctx.$store.state.pk.status === 'Matching' && $setup.show_countdown === 'no' ? (_openBlock(), _createBlock(_component_MatchGround, {\n    key: 2\n  })) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementBlock","_Fragment","$setup","show_countdown","_createBlock","_component_vue_countdown","key","time","$data","interval","default","_withCtx","seconds","milliseconds","_createTextVNode","_toDisplayString","Math","floor","_","_createCommentVNode","_ctx","$store","state","pk","status","_component_PlayGround","_component_MatchGround"],"sources":["/Users/muzhouliu/Desktop/acwing/kob/web/src/views/pk/pkIndexView.vue"],"sourcesContent":["<template>\n    <vue-countdown v-if=\"show_countdown === 'yes'\" :time=\"time\" :interval=\"100\" v-slot=\"{seconds, milliseconds }\">\n    Game Starts in {{ seconds }}.{{ Math.floor(milliseconds / 100) }} seconds.\n  </vue-countdown>\n    <PlayGround v-if=\"$store.state.pk.status === 'Playing' && show_countdown === 'no'\"></PlayGround>\n    <MatchGround v-if=\"$store.state.pk.status === 'Matching' && show_countdown === 'no'\"></MatchGround>\n</template>\n\n\n<script>\nimport PlayGround from \"@/components/PlayGround.vue\"\nimport MatchGround from \"@/components/MatchGround.vue\"\nimport { onMounted, onUnmounted , ref} from \"vue\"\nimport { useStore } from \"vuex\";\n\nexport default {\n    components: {\n    PlayGround,\n    MatchGround,\n    },\n    setup() {\n        const store = useStore();\n        const socketUrl = `ws://localhost:8888/websocket/${store.state.user.token}`;\n        let show_countdown = ref(\"no\")\n\n        let socket = null;\n        onMounted(() => {\n            store.commit(\"updateOpponent\", {\n                username: '???',\n                photo : \"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png\"\n            })\n            socket = new WebSocket(socketUrl);\n\n            socket.onopen = () => {\n                console.log(\"Connected\");\n                store.commit(\"updateSocket\", socket)\n            }\n\n            socket.onmessage = msg => {\n                const data = JSON.parse(msg.data);\n                if (data.event === \"start-matching\") { // maching success\n                    store.commit(\"updateOpponent\", {\n                        username: data.opponent_username,\n                        photo: data.opponent_photo,\n                    });\n                    show_countdown.value = 'yes';\n                    const current = new Date();\n                    const date =\n                        current.getFullYear() +\n                        \"-\" +\n                        current.getMonth() +\n                        \"-\" +\n                        current.getDate();\n                    const time =\n                        current.getHours() +\n                        \":\" +\n                        current.getMinutes() +\n                        \":\" +\n                        (current.getSeconds() + 2);\n                    const two_seconds_later = date + \" \" + time;\n                    setTimeout(() => {\n                        store.commit(\"updateStatus\", \"Playing\")\n                    }, 2000)\n                    show_countdown.value = 'no';\n                    store.commit(\"updateGameMap\", data.game_map)\n                }\n                console.log(data);\n            }\n\n            socket.onclose = () => {\n                console.log(\"Connection closed\");\n            }\n\n        });\n\n        onUnmounted(() => {\n            socket.close();\n        })\n\n        return {\n            show_countdown,\n            two_seconds_later\n        }\n    },\n    data() {\n        const now = new Date();\n        return {\n        time: this.two_seconds_later - now,\n        }\n    }   \n\n}\n</script>\n\n\n<style scoped>\n</style>"],"mappings":";;;;;uBAAAA,mBAAA,CAAAC,SAAA,SACyBC,MAAA,CAAAC,cAAc,c,cAAnCC,YAAA,CAEcC,wBAAA;IAHlBC,GAAA;IACoDC,IAAI,EAAEC,KAAA,CAAAD,IAAI;IAAGE,QAAQ,EAAE;;IAD3EC,OAAA,EAAAC,QAAA,CACkH,CAC/F;MADsEC,OAAO;MAAEC;IAAY,OAD9GC,gBAAA,CACkH,kBAC/F,GAAAC,gBAAA,CAAGH,OAAO,IAAG,GAAC,GAAAG,gBAAA,CAAGC,IAAI,CAACC,KAAK,CAACJ,YAAY,WAAU,YACnE,gB;IAHFK,CAAA;iCAAAC,mBAAA,gBAIsBC,IAAA,CAAAC,MAAM,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,kBAAkBtB,MAAA,CAAAC,cAAc,a,cAAxEC,YAAA,CAAgGqB,qBAAA;IAJpGnB,GAAA;EAAA,MAAAa,mBAAA,gBAKuBC,IAAA,CAAAC,MAAM,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,mBAAmBtB,MAAA,CAAAC,cAAc,a,cAA1EC,YAAA,CAAmGsB,sBAAA;IALvGpB,GAAA;EAAA,MAAAa,mBAAA,e"},"metadata":{},"sourceType":"module","externalDependencies":[]}